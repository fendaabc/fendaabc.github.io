<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>dockerNote | 芬达里没有泡泡</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">dockerNote</h1><a id="logo" href="/.">芬达里没有泡泡</a><p class="description">来杯可乐,不加糖</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">dockerNote</h1><div class="post-meta">2021-03-01<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 5.3k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 22</span><span class="post-meta-item-text"> 分钟</span></span></span></div><a class="disqus-comment-count" data-disqus-identifier="2021/03/01/dockerNote/" href="/2021/03/01/dockerNote/#disqus_thread"></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">入门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">2.</span> <span class="toc-text">配置镜像加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">底层原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">4.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">4.2.</span> <span class="toc-text">镜像命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-images-%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E6%9C%AC%E5%9C%B0%E7%9A%84%E4%B8%BB%E6%9C%BA%E4%B8%8A%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">4.2.1.</span> <span class="toc-text">docker images #查看所有本地的主机上的镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-search-%E6%90%9C%E7%B4%A2docker%E9%95%9C%E5%83%8F"><span class="toc-number">4.2.2.</span> <span class="toc-text">docker search  #搜索docker镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-pull-%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F"><span class="toc-number">4.2.3.</span> <span class="toc-text">docker pull    #下载镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-rmi-%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F"><span class="toc-number">4.2.4.</span> <span class="toc-text">docker rmi 删除镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.3.</span> <span class="toc-text">容器命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%B9%B6%E5%90%AF%E5%8A%A8"><span class="toc-number">4.3.1.</span> <span class="toc-text">新建容器并启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E5%87%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">4.3.2.</span> <span class="toc-text">列出容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">4.3.3.</span> <span class="toc-text">退出容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="toc-number">4.3.4.</span> <span class="toc-text">删除容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%92%8C%E5%81%9C%E6%AD%A2%E5%AE%B9%E5%99%A8"><span class="toc-number">4.3.5.</span> <span class="toc-text">启动和停止容器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E7%9A%84%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.4.</span> <span class="toc-text">docker的其他常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%981%EF%BC%9A%E5%AE%B9%E5%99%A8%E4%BB%A5%E5%90%8E%E5%8F%B0%E6%96%B9%E5%BC%8F%E5%90%AF%E5%8A%A8%E5%90%8E%E8%87%AA%E5%8A%A8%E5%85%B3%E9%97%AD"><span class="toc-number">4.4.1.</span> <span class="toc-text">问题1：容器以后台方式启动后自动关闭</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="toc-number">4.4.2.</span> <span class="toc-text">查看日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E4%B8%AD%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">4.4.3.</span> <span class="toc-text">查看容器中进程信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">4.4.4.</span> <span class="toc-text">查看镜像的元数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E5%BD%93%E5%89%8D%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">4.4.5.</span> <span class="toc-text">进入当前正在运行的容器</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number"></span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">1.</span> <span class="toc-text">练习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%EF%BC%88%E5%87%A0%E4%B9%8E%E4%B8%8D%E7%94%A8%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">可视化工具（几乎不用）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E9%95%9C%E5%83%8F"><span class="toc-number">3.</span> <span class="toc-text">docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UnionFS%EF%BC%88%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">UnionFS（联合文件系统）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%90%86%E8%A7%A3"><span class="toc-number">3.2.</span> <span class="toc-text">分层理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commit%E9%95%9C%E5%83%8F"><span class="toc-number">3.3.</span> <span class="toc-text">commit镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">4.</span> <span class="toc-text">容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">4.1.</span> <span class="toc-text">使用数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%EF%BC%9A%E5%AE%89%E8%A3%85Mysql"><span class="toc-number">4.1.1.</span> <span class="toc-text">测试：安装Mysql</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">4.2.</span> <span class="toc-text">具名挂载和匿名挂载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerFile"><span class="toc-number">5.</span> <span class="toc-text">dockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">5.0.1.</span> <span class="toc-text">数据卷容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9Adockerfile%E6%9E%84%E5%BB%BA%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-number">5.0.2.</span> <span class="toc-text">总结：dockerfile构建步骤：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DokcerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="toc-number">5.0.3.</span> <span class="toc-text">DokcerFile构建过程：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DockerFile%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">5.0.4.</span> <span class="toc-text">DockerFile的指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84centos"><span class="toc-number">5.0.5.</span> <span class="toc-text">练习：创建自己的centos</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0tomcat%E9%95%9C%E5%83%8F%E7%9A%84build"><span class="toc-number">5.0.6.</span> <span class="toc-text">练习tomcat镜像的build</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E9%95%9C%E5%83%8F"><span class="toc-number">6.</span> <span class="toc-text">发布镜像</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker%E7%BD%91%E7%BB%9C"><span class="toc-number"></span> <span class="toc-text">Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C"><span class="toc-number">0.1.</span> <span class="toc-text">认识网络</span></a></li></ol></li></ol></div></div><div class="post-content"><p>docker和虚拟机的区别：</p>
<ul>
<li>虚拟机，虚拟出一条硬件，运行一个完整的操作系统，然后在这个系统中安装和运行软件</li>
<li>容器中应用直接运行在宿主机的内核，容器是没有自己的内核的，也没有虚拟我们的硬件，所以轻便</li>
<li>每个容器之间是相互隔离的，每个容器内都有一个属于自己的文件系统，互不影响。</li>
</ul>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="comment">#查看版本</span></span><br><span class="line">docker version</span><br><span class="line"><span class="comment">#运行镜像hello-world</span></span><br><span class="line">docker run hello-world</span><br><span class="line">如果提示unable to find images的话会自动去pull这个镜像，直到直到提示Hello from Docker表示镜像拉取成功，</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看镜像</span></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果不需要docker了进行卸载的话</span></span><br><span class="line"><span class="comment">#1 卸载依赖</span></span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="comment">#2 删除资源（docker的默认工作目录）</span></span><br><span class="line">rm -rf /var/lib/docker</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="配置镜像加速"><a href="#配置镜像加速" class="headerlink" title="配置镜像加速"></a>配置镜像加速</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;registry-mirrors&quot;</span>:[<span class="string">&quot;https://qiyb9988.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/03/01/ONcMK7mLZy6VzPe.png" alt="image-20210301145044860"></p>
<h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><p>如何工作：</p>
<p>Docker是一个CS结构的系统，Docker的守护进程运行在主机上，通过socket从客户端访问，DocketServer接收到Docker-Client的指令，就会执行这个命令</p>
<p>为什么docker比虚拟机更快</p>
<ol>
<li><p>docker有着比虚拟机更少的抽象层</p>
</li>
<li><p>docker利用的是宿主机的内核，vm需要GuestOS<img src="https://i.loli.net/2021/03/01/wkIArOqnC46zDej.png" alt="image-20210301150019104"></p>
<p>所以，在新建一个容器时候，docker不需要像虚拟机一样重新加载一个操作系统内核，避免引导。虚拟机是加载GuestOS，分钟级别，而docker是利用宿主机的操作系统，省略了复杂的过程，秒级别</p>
</li>
</ol>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version     <span class="comment">#版本信息</span></span><br><span class="line">docker info        <span class="comment">#显示docker的系统信息，包括镜像和容器的数量</span></span><br><span class="line">docker 命令 --<span class="built_in">help</span>  <span class="comment">#帮助命令</span></span><br></pre></td></tr></table></figure>

<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><h4 id="docker-images-查看所有本地的主机上的镜像"><a href="#docker-images-查看所有本地的主机上的镜像" class="headerlink" title="docker images #查看所有本地的主机上的镜像"></a><strong>docker images</strong> #查看所有本地的主机上的镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">yb@yanling:~$ docker images</span><br><span class="line">REPOSITORY      TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">bestwu/wechat   latest    dc95baea4912   7 weeks ago     864MB</span><br><span class="line">hello-world     latest    bf756fb1ae65   14 months ago   13.3kB</span><br><span class="line"></span><br><span class="line"><span class="comment">#解释</span></span><br><span class="line">REPOSITORY   镜像的仓库源</span><br><span class="line">TAG		     镜像的标签</span><br><span class="line">IMAGE ID 	 镜像的id</span><br><span class="line">CREATED      镜像的创建时间</span><br><span class="line">SIZE         镜像的大小</span><br><span class="line"></span><br><span class="line"><span class="comment">#可选项</span></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             <span class="comment">#列出所有的镜像</span></span><br><span class="line">  -q, --quiet           <span class="comment">#只显示镜像的id</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="docker-search-搜索docker镜像"><a href="#docker-search-搜索docker镜像" class="headerlink" title="docker search  #搜索docker镜像"></a><strong>docker search</strong>  <strong>#搜索docker镜像</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#docker search mysql</span></span><br><span class="line">yb@yangbin:~$ docker search --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker search [OPTIONS] TERM</span><br><span class="line"></span><br><span class="line">Search the Docker Hub <span class="keyword">for</span> images</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="docker-pull-下载镜像"><a href="#docker-pull-下载镜像" class="headerlink" title="docker pull    #下载镜像"></a><strong>docker pull    #下载镜像</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker pull 镜像名 [:tag]</span></span><br><span class="line">yb@yangbin:~$ docker pull mysql</span><br><span class="line">Using default tag: latest  <span class="comment">#如果不写tag，默认下载最新版</span></span><br><span class="line">latest: Pulling from library/mysql  </span><br><span class="line">a076a628af6f: Pull complete  <span class="comment">#分层下载，docker image的核心， 联合文件系统</span></span><br><span class="line">f6c208f3f991: Pull complete </span><br><span class="line">88a9455a9165: Pull complete </span><br><span class="line">406c9b8427c6: Pull complete </span><br><span class="line">7c88599c0b25: Pull complete </span><br><span class="line">25b5c6debdaf: Pull complete </span><br><span class="line">43a5816f1617: Pull complete </span><br><span class="line">1a8c919e89bf: Pull complete </span><br><span class="line">9f3cf4bd1a07: Pull complete </span><br><span class="line">80539cea118d: Pull complete </span><br><span class="line">201b3cad54ce: Pull complete </span><br><span class="line">944ba37e1c06: Pull complete </span><br><span class="line">Digest: sha256:feada149cb8ff54eade1336da7c1d080c4a1c7ed82b5e320efb5beebed85ae8c <span class="comment">#签名</span></span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:latest</span><br><span class="line">docker.io/library/mysql:latest  <span class="comment">#真实地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#上面命令等价于</span></span><br><span class="line">docker pull mysql</span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#docker pull mysql:5.7</span></span><br><span class="line">yb@yangbin:~$ docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Already exists   <span class="comment">#区别于上面的下载完整，这里显示的已经存在，联合文件系统的运用</span></span><br><span class="line">f6c208f3f991: Already exists </span><br><span class="line">88a9455a9165: Already exists </span><br><span class="line">406c9b8427c6: Already exists </span><br><span class="line">7c88599c0b25: Already exists </span><br><span class="line">25b5c6debdaf: Already exists </span><br><span class="line">43a5816f1617: Already exists </span><br><span class="line">1831ac1245f4: Pull complete </span><br><span class="line">37677b8c1f79: Pull complete </span><br><span class="line">27e4ac3b0f6e: Pull complete </span><br><span class="line">7227baa8c445: Pull complete </span><br><span class="line">Digest: sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808df</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure>

<h4 id="docker-rmi-删除镜像"><a href="#docker-rmi-删除镜像" class="headerlink" title="docker rmi 删除镜像"></a><strong>docker rmi 删除镜像</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f 容器id      <span class="comment">#删除指定容器</span></span><br><span class="line">docker rmi -f 容器id 容器id  <span class="comment">#删除多个容器</span></span><br><span class="line">docker rmi -f ￥&#123;docker images -aq&#125;  <span class="comment">#删除全部的容器</span></span><br></pre></td></tr></table></figure>

<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><blockquote>
<p>说明：有了镜像才可以创建容器，linux，下载一个centos镜像测试学习</p>
</blockquote>
<h4 id="新建容器并启动"><a href="#新建容器并启动" class="headerlink" title="新建容器并启动"></a>新建容器并启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"></span><br><span class="line"><span class="comment">#参数说明</span></span><br><span class="line">-name=<span class="string">&quot;Name&quot;</span>    容器名字  tomcat01   tomcat02   用来区分容器</span><br><span class="line">-d              后台方式运行</span><br><span class="line">-it             使用交互方式运行，进入容器查看内容</span><br><span class="line">-p</span><br><span class="line">		-p		主机端口：容器端口（常用）</span><br><span class="line">		-p      ip：主机端口：容器端口</span><br><span class="line">        -p		容器端口</span><br><span class="line">        		容器端口</span><br><span class="line">-P				随机指定端口</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试 启动并进入容器</span></span><br><span class="line">yb@yangbin:~$ docker images</span><br><span class="line">REPOSITORY      TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mysql           5.7       a70d36bc331a   5 weeks ago     449MB</span><br><span class="line">centos          latest    300e315adb2f   2 months ago    209MB</span><br><span class="line">hello-world     latest    bf756fb1ae65   14 months ago   13.3kB</span><br><span class="line">yb@yangbin:~$ docker run -it centos /bin/bash</span><br><span class="line">[root@cb57e4f2755c /]<span class="comment"># ls  #镜像内部的目录也是一个类似于服务器的目录</span></span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="列出容器"><a href="#列出容器" class="headerlink" title="列出容器"></a>列出容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker ps 命令</span></span><br><span class="line">	 空	    <span class="comment">#列出当前正在运行的容器</span></span><br><span class="line">	-a		<span class="comment">#列出全部容器（包括在运行和未运行）</span></span><br><span class="line">	-n=？    <span class="comment">#显示最近创建的？个容器（？处写数字，列出最近创建的？个容器）</span></span><br><span class="line">	-q		<span class="comment">#只显示容器的编号</span></span><br></pre></td></tr></table></figure>

<h4 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span>         <span class="comment">#直接退停止出容器</span></span><br><span class="line">Ctrl +P +Q   <span class="comment">#容器不停止退出</span></span><br></pre></td></tr></table></figure>

<h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 镜像id                <span class="comment">#删除指定容器,运行中的需要使用 -f删除</span></span><br><span class="line">docker rm -f $(docker ps -aq)  <span class="comment">#删除全部容器</span></span><br><span class="line">docker ps -a -q|xargs docker rm<span class="comment">#删除全部容器</span></span><br></pre></td></tr></table></figure>

<h4 id="启动和停止容器"><a href="#启动和停止容器" class="headerlink" title="启动和停止容器"></a>启动和停止容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id    <span class="comment">#启动容器</span></span><br><span class="line">docker restart 容器id  <span class="comment">#重启容器</span></span><br><span class="line">docker stop 容器id	 <span class="comment">#停止当前正在运行的容器</span></span><br><span class="line">docker <span class="built_in">kill</span> 容器id     <span class="comment">#强制停止当前的容器</span></span><br></pre></td></tr></table></figure>

<h3 id="docker的其他常用命令"><a href="#docker的其他常用命令" class="headerlink" title="docker的其他常用命令"></a>docker的其他常用命令</h3><h4 id="问题1：容器以后台方式启动后自动关闭"><a href="#问题1：容器以后台方式启动后自动关闭" class="headerlink" title="问题1：容器以后台方式启动后自动关闭"></a>问题1：容器以后台方式启动后自动关闭</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d 容器名 <span class="comment">#启动后用docker ps查看发现容器已经被关闭了</span></span><br><span class="line"><span class="comment">#因为：容器后台运行，必须要有一个前台进程，docker发现没有前台应用，就会自动停止</span></span><br></pre></td></tr></table></figure>

<h4 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker logs -tf --tail 10 bfdc57ff20d2 <span class="comment">#显示容器bfdc57ff20d2的最近十行的实时日志</span></span><br><span class="line"></span><br><span class="line">docker logs --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h4 id="查看容器中进程信息"><a href="#查看容器中进程信息" class="headerlink" title="查看容器中进程信息"></a>查看容器中进程信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top bfdc57ff20d2 <span class="comment">#显示容器的uid pid等等信息</span></span><br></pre></td></tr></table></figure>

<h4 id="查看镜像的元数据"><a href="#查看镜像的元数据" class="headerlink" title="查看镜像的元数据"></a>查看镜像的元数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker inspect bfdc57ff20d2</span><br><span class="line"><span class="comment">#显示容器的id，创建时间，位置，参数，进程id，父进程id，容器名字，配置环境，网络信息</span></span><br></pre></td></tr></table></figure>

<h4 id="进入当前正在运行的容器"><a href="#进入当前正在运行的容器" class="headerlink" title="进入当前正在运行的容器"></a>进入当前正在运行的容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#日常，我们的容器都是一直在后台运行的，当需要查看并修改容器的时候如何进入：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式1           #进入容器并开启一个新的终端，开始新的操作（常用）</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 60a68e7d2b37 /bin/bash</span><br><span class="line"><span class="comment">#方式2		   #进入容器正在执行的终端，继续正在执行的操作，不开启新的终端</span></span><br><span class="line">docker attach 容器id</span><br></pre></td></tr></table></figure>



<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><img src="https://i.loli.net/2021/03/01/iTxLHhoX6wAQMjv.png" alt="docker"></p>
<p><img src="https://i.loli.net/2021/03/01/l6OcmbZyhNuBWQj.png" alt="docker命令1"></p>
<p><img src="https://i.loli.net/2021/03/01/fm7MnW8UBEo9RdP.png" alt="docker命令2"></p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>部署nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.用search搜索镜像（推荐使用dockerhub可以查看images的详细信息）</span><br><span class="line">2.拉取镜像</span><br><span class="line">3.以后台的方式启动容器并将端口进行映射</span><br><span class="line">docker run -d --name nginx01 -p 3344：80 nginx </span><br><span class="line"><span class="comment"># -d 后台运行</span></span><br><span class="line"><span class="comment"># --name 给容器起别名，nginx01是镜像的别名，</span></span><br><span class="line"><span class="comment"># -p 宿主机端口：容器内部端口    3344是对外暴露的端口，80是内部的端口，</span></span><br><span class="line"></span><br><span class="line">扩展：</span><br><span class="line">每次修改容器的配置文件需要重新进入容器进行编辑，相对比较麻烦，有没有可能将配置文件路径映射出来直接进行访问------&gt;  数据卷技术</span><br></pre></td></tr></table></figure>

<p>部署tomcat</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1.搜索镜像(推荐使用dockerhub查看镜像的详细信息)</span><br><span class="line"></span><br><span class="line">2.拉取镜像</span><br><span class="line"><span class="comment">#官方tomcat的使用</span></span><br><span class="line">docker run -it --rm tomcat:9.0  <span class="comment">#--rm使用完立即删除，主要用于测试，不推荐</span></span><br><span class="line"><span class="comment">#日常使用</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"></span><br><span class="line">3.启动容器并将端口对外映射</span><br><span class="line">docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line"><span class="comment"># -d    以后台的方式运行</span></span><br><span class="line"><span class="comment"># -p    宿主机端口：内部端口</span></span><br><span class="line"><span class="comment"># --name 容器别名</span></span><br><span class="line"><span class="comment"># 镜像名称</span></span><br><span class="line"></span><br><span class="line">4.进入容器</span><br><span class="line">docker <span class="built_in">exec</span> -it tomcat01 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#出现的问题：1.linux命令少了，  2.没有webapps  --》原因：阿里云镜像造成的，默认只保留了最小的镜像，所有不必要的都进行了提出，保证最小可运行环境</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">扩展：</span><br><span class="line">每次修改容器的配置文件需要重新进入容器进行编辑，相对比较麻烦，有没有可能将配置文件路径映射出来直接进行访问------&gt;  数据卷技术</span><br></pre></td></tr></table></figure>

<p>部署ES+Kibana</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#es 暴露的端口很多</span></span><br><span class="line"><span class="comment">#es 十分消耗内存</span></span><br><span class="line"><span class="comment">#es 的数据一般需要放置到安全目录 挂在</span></span><br><span class="line"><span class="comment">#    --net somenetwork ？ 网络的配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动es</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsearch:7.6.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看cpu的状态信息</span></span><br><span class="line">docker stats</span><br><span class="line"></span><br><span class="line"><span class="comment">#停止docker</span></span><br><span class="line">docker stop </span><br><span class="line"></span><br><span class="line"><span class="comment">#发现elasticsearch占用内存特别高，增加对内存的限制。。。。修改配置文件，-e，环境配置修改</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> -d ES_JAVA_OPTS<span class="string">&quot;-Xms64m -Xmx512m&quot;</span> elasticsearch:7.6.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">拓展：使用kibana来连接es，</span><br><span class="line">由于两个都是在docker内部的容器，而容器之间相互隔离，所以无法直接进行通信，但它们都是基于相同的linux服务所以可以考虑内网ip进行转发。？？？？网络相关教程需要看一下</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="可视化工具（几乎不用）"><a href="#可视化工具（几乎不用）" class="headerlink" title="可视化工具（几乎不用）"></a>可视化工具（几乎不用）</h2><p>portainer</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 \--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=<span class="literal">true</span> portainer/portainer</span><br></pre></td></tr></table></figure>

<p>Rancher（CI/CD再用）</p>
<h2 id="docker镜像"><a href="#docker镜像" class="headerlink" title="docker镜像"></a>docker镜像</h2><h3 id="UnionFS（联合文件系统）"><a href="#UnionFS（联合文件系统）" class="headerlink" title="UnionFS（联合文件系统）"></a>UnionFS（联合文件系统）</h3><ol>
<li><p>下载时候看到的一层一层的就是这个，会一次同时加载多个文件系统，但从外面看只有一个文件系统，联合加载会把隔层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
</li>
<li><p>bootfs（boot file system）：主要包含BootLoader和kernel，BootLoader主要是引导加载kernel，linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs，这一层与我们典型的linux、unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转给内核，此时系统也会卸载bootfs。</p>
</li>
<li><p>rootfs（root file system）：在bootfs之上，包含的就是典型Linux系统中的/dev /proc  /bin  /etc 等标准的目录和文件，rootfs就是各种不同的操作系统发行版本，比如ubuntu centos等等（）</p>
<p>对于一个精简的os，rootfs可以很小，只需要包含最基本的命令，工具和程序就可以了，因为底层直接用host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的linux发行版本，bootfs基本是一致的，rootfs会有差别，因此不同的发行版本可以公用bootfs。</p>
</li>
</ol>
<h3 id="分层理解"><a href="#分层理解" class="headerlink" title="分层理解"></a>分层理解</h3><p>在拉取镜像的时候对于别的镜像已经拉取的那一层会显示already exist，只有不存在的才会进行下载。</p>
<p>所有的docker镜像都起始于一个基础镜像层，当进行修改或者增加新的内容时，就会在当前镜像层之上创建新的镜像层。</p>
<p>对于新pull过来的一个镜像会存在一个镜像层，如果运行起来的话那就是一个容器层，如果需要把它打包发给别人运行那就是重新打包成一个镜像进行commit，然后别人再拉取过来进行运行会是一个新的包含你的容器层和镜像层的新的镜像层。</p>
<h3 id="commit镜像"><a href="#commit镜像" class="headerlink" title="commit镜像"></a>commit镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line"></span><br><span class="line"><span class="comment">#命令和git原理类似</span></span><br><span class="line">docker commit -m<span class="string">&quot;提交的描述信息&quot;</span> -a=<span class="string">&quot;作者&quot;</span> 容器id 目标镜像名：[tag]</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.启动一个默认tomcat</span><br><span class="line">2.发现tomcat的webapps中没有文件，所以copy了一个进来</span><br><span class="line">3.将修改完容器通过commit提交为一个新的镜像</span><br></pre></td></tr></table></figure>

<p>可以使用commit来对当前的镜像进行备份，保存当前的状态。</p>
<h2 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h2><p>只要删除了容器数据就会丢失， 需求：数据持久化，数据可以保存在本地，容器之间可以有一个数据共享的技术。</p>
<p>卷技术：目录的挂载，将我们容器内的目录挂载到linux上面。</p>
<h3 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#直接使用命令来挂载</span></span><br><span class="line">docker run -it -v 主机目录：容器内目录 -p</span><br><span class="line"></span><br><span class="line">例子：</span><br><span class="line"><span class="comment">#运行并挂载</span></span><br><span class="line">docker run -it -v /home/ceshi:/home centos /bin/bash</span><br><span class="line"><span class="comment">#用inspect查看</span></span><br><span class="line">docker inspect 01493ee7273b</span><br><span class="line"><span class="comment">#里面有个mount模块，记录了卷挂载的相关信息</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/03/02/cs61KGOrkDZMWtL.png" alt="image-20210302094515337"></p>
<h4 id="测试：安装Mysql"><a href="#测试：安装Mysql" class="headerlink" title="测试：安装Mysql"></a>测试：安装Mysql</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="comment">#命令</span></span><br><span class="line">-d   	后台方式运行</span><br><span class="line">-p	 	端口映射</span><br><span class="line">-v   	数据挂载</span><br><span class="line">-e   	参数配置（这块配置的是密码）</span><br><span class="line">--name 	容器别名</span><br><span class="line">-tag    5.7表示使用的镜像的版本</span><br></pre></td></tr></table></figure>

<p>即使容器被删除，挂载到本地的数据卷依旧没有被删除。</p>
<h3 id="具名挂载和匿名挂载"><a href="#具名挂载和匿名挂载" class="headerlink" title="具名挂载和匿名挂载"></a>具名挂载和匿名挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#匿名挂载</span></span><br><span class="line">-v 容器内路径</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line">不指定宿主机的位置，只对容器中的位置进行指定</span><br><span class="line">通过inspect命令查看卷的位置</span><br><span class="line"><span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;fcf73dbad7a3a3890bcc1c5f432a13e97dd5bd68edbadcd260b212c6ab4c10a6&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/fcf73dbad7a3a3890bcc1c5f432a13e97dd5bd68edbadcd260b212c6ab4c10a6/_data&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;/etc/nginx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#具名挂载</span></span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">这里juming前面没有加/表示juming-nginx只是一个名字</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;juming-nginx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/juming-nginx/_data&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;/etc/nginx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;z&quot;</span>,</span><br><span class="line">                <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">通过inspect命令查看卷的位置</span><br><span class="line"></span><br><span class="line">docker volume ls  <span class="comment">#列出所有卷的信息，然后找到我们的刚才挂载的juming-nginx</span></span><br><span class="line">docker volume inspect juming-nginx <span class="comment">#查看挂在卷的具体信息</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2021-03-02T10:22:52+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/juming-nginx/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;juming-nginx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所有docker容器内的卷没有指定目录的情况下都挂载在==/var/lib/docker/volumes/xxxx/_data==</p>
<p>通过具名挂载可以很方便的找到一个卷，所以大多数情况使用的是==具名挂载==</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#区分具名挂载和匿名挂载</span></span><br><span class="line">-v  容器内路径 		         <span class="comment">#匿名挂载</span></span><br><span class="line">-v  卷名：容器内路径  		   <span class="comment">#具名挂载</span></span><br><span class="line">-v  /宿主机路径：：容器内路径   <span class="comment">#指定路径挂载</span></span><br></pre></td></tr></table></figure>

<h2 id="dockerFile"><a href="#dockerFile" class="headerlink" title="dockerFile"></a>dockerFile</h2><blockquote>
<p>dockerFile就是用来构建docker镜像的构建文件，命令脚本。</p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本是一个个的命令，每个命令都是一层</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建一个dockerfile文件，名字可以随机，建议使用dockerfile</span></span><br><span class="line"><span class="comment">#文件中的内容</span></span><br><span class="line">FROM centos  <span class="comment">#指令（大写）+参数</span></span><br><span class="line"></span><br><span class="line">VOLUME [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>]</span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;---end---&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="comment">#上面的每个命令就是镜像的一层</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/03/02/SJUnGT8o4ltmEL6.png" alt="image-20210302105627858"></p>
<h4 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h4><p>==–volumes-from==</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.使用上面自定义的镜像创建容器1</span><br><span class="line">2.使用自定义镜像创建容器2并将卷挂载在容器1   命令如下</span><br><span class="line">docker run -it --name docker01  8c54f316091c</span><br><span class="line">docker run -it --name docker02 --volumes-from docker01  8c54f316091c</span><br><span class="line">将两个容器都放在后台运行后，然后在容器1的volume01中创建任意文件容器二也会包含相同文件</span><br><span class="line">将容器1删除或者停止后发现volume01 02中的文件仍然可以访问，说明几个挂载卷之间的文件是相互备份进行拷贝的</span><br></pre></td></tr></table></figure>

<h4 id="总结：dockerfile构建步骤："><a href="#总结：dockerfile构建步骤：" class="headerlink" title="总结：dockerfile构建步骤："></a>总结：dockerfile构建步骤：</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">dockerFile</span>是用来构建<span class="selector-tag">docker</span>镜像的文件！命令参数脚本！</span><br><span class="line"></span><br><span class="line">1.编写一个<span class="selector-tag">dockerfile</span>文件</span><br><span class="line">2<span class="selector-class">.dockerbuild</span> 构建成为一个镜像</span><br><span class="line">3<span class="selector-class">.docker</span> <span class="selector-tag">run</span>运行镜像</span><br><span class="line">4<span class="selector-class">.docker</span> <span class="selector-tag">push</span>发布镜像（<span class="selector-tag">docker</span> <span class="selector-tag">hub</span>、阿里云镜像仓库）</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="DokcerFile构建过程："><a href="#DokcerFile构建过程：" class="headerlink" title="DokcerFile构建过程："></a>DokcerFile构建过程：</h4><p><strong>基础知识</strong>：</p>
<p>1.每个保留关键字（指令）必须是大写</p>
<p>2.执行从上到下顺序执行</p>
<p>3.#标识注释</p>
<p>4.每个指令都会创建提交一个新的镜像层，一层层提交</p>
<p><img src="https://i.loli.net/2021/03/02/kqpsO8DaTwv1YMH.png" alt="image-20210302113046993"></p>
<p>发布项目就需要做镜像，需要编写dockerfile文件</p>
<p>Dockerfile：构建文件，定义了一切的步骤，源代码</p>
<p>DockerImages： 通过dockerfile构建生成的镜像，最终发布和运行的产品</p>
<p>docker容器：容器就是镜像运行起来提供服务器</p>
<h4 id="DockerFile的指令"><a href="#DockerFile的指令" class="headerlink" title="DockerFile的指令"></a>DockerFile的指令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM   			<span class="comment">#基础镜像，一切从这里开始构建</span></span><br><span class="line">MAINTAINER 		<span class="comment">#镜像是谁写的，姓名+邮箱</span></span><br><span class="line">RUN				<span class="comment">#镜像构建的时候需要运行的命令</span></span><br><span class="line">ADD				<span class="comment">#步骤：tomcat镜像，这个tomcat压缩包就需要add进去</span></span><br><span class="line">WORKDIR			<span class="comment">#镜像的工作目录</span></span><br><span class="line">VOLUME			<span class="comment">#挂载的目录</span></span><br><span class="line">EXPOSE			<span class="comment">#暴露端口配置</span></span><br><span class="line">CMD				<span class="comment">#指定容器启动时候运行的命令，只有最后一个命令会生效，可被替代</span></span><br><span class="line">ENTRYPOINT		<span class="comment">#指定这个容器启动的时候需要运行的命令，多个命令都可以生效，可追加命令</span></span><br><span class="line">ONBUILD			<span class="comment">#当构建一个被继承DockerFile这个时候就会运行ONBUILD的指令，出发指令</span></span><br><span class="line">COPY			<span class="comment">#类似于ADD，经文件拷贝到镜像中</span></span><br><span class="line">ENV				<span class="comment">#构建的时候设置环境变量</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/03/02/QdbWtFzqYarLKyh.png" alt="Dockerfile图解"></p>
<h4 id="练习：创建自己的centos"><a href="#练习：创建自己的centos" class="headerlink" title="练习：创建自己的centos"></a>练习：创建自己的centos</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1.先在home目录创建一个文件夹用于存放自己的dockerfile</span><br><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line">mkdir mydockerfile</span><br><span class="line">touch mydockerfile-centos</span><br><span class="line">2.编辑dockerfile文件</span><br><span class="line">sudo gedit mydockerfile-centos</span><br><span class="line">内容如下：</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER larry&lt;fenda.abc@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/<span class="built_in">local</span></span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span>   				<span class="comment">#这个目录就是一进入容器pwd的目录</span></span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span><br><span class="line">CMD ceho <span class="string">&quot;---end---&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line">3.进行build构建操作</span><br><span class="line"><span class="comment">#命令 docker build -f dockerfile文件名 -t 镜像名：[tag]</span></span><br><span class="line">docker build -f mydockerfile-centos -t mycentos:0.1 .</span><br><span class="line"></span><br><span class="line">4.测试自己创建的镜像，如下</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/03/02/SyLtWNGvzXEskrm.png" alt="image-20210302121233384"></p>
<p>可以使用==docker history  镜像id==查看镜像的变更历史</p>
<p><strong>对比cmd和entrypoint</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD				<span class="comment">#指定容器启动时候运行的命令，只有最后一个命令会生效，如果run容器的时候追加了命令，那容器中默认的bash命令不再执行而转而执行run后面追加的命令，相当于替换了最后一个命令</span></span><br><span class="line">ENTRYPOINT		<span class="comment">#指定这个容器启动的时候需要运行的命令，多个命令都可以生效，虽然dockerfile文件中已经有了bash命令但在启动的时候仍然追加了其他命令，相当于可追加命令，</span></span><br></pre></td></tr></table></figure>

<h4 id="练习tomcat镜像的build"><a href="#练习tomcat镜像的build" class="headerlink" title="练习tomcat镜像的build"></a>练习tomcat镜像的build</h4><ol>
<li><p>准备镜像文件： tomcat压缩包 jdk压缩包sudo</p>
</li>
<li><p>编写DockerFile文件，命名DockerFile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER larry&lt;fenda.abc@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/<span class="built_in">local</span>/readme.txt</span><br><span class="line"></span><br><span class="line">ADD apache-tomcat-7.0.108.tar.gz /usr/<span class="built_in">local</span>/</span><br><span class="line">ADD jdk-11.0.10_linux-x64_bin.tar.gz /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/<span class="built_in">local</span></span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/<span class="built_in">local</span>/jdk-11.0.10</span><br><span class="line">ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/<span class="built_in">local</span>/apache-tomcat-7.0.108</span><br><span class="line">ENV CATALINA_BASE /usr/<span class="built_in">local</span>/apache-tomcat-7.0.108</span><br><span class="line">ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$CATALINA_HOME</span>/lib:<span class="variable">$CATALINA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/<span class="built_in">local</span>/apache-tomcat-7.0.108/bin/startup.sh &amp;&amp; tail -F /url/<span class="built_in">local</span>/apache-tomcat-7.0.108/bin/logs/catalina.out</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#正常来说这里可以不用写-f DockerFile，因为命名符合官方要求所以是可以省略的，但我的不行，我就写上了</span></span><br><span class="line">docker build -f DockerFile -t diytomcat .</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-d 		后台启动</span></span><br><span class="line"><span class="comment">#-p 		端口映射</span></span><br><span class="line"><span class="comment">#--name		别名</span></span><br><span class="line"><span class="comment">#-v			目录挂载（一个发布目录和一个日志目录了）</span></span><br><span class="line"><span class="comment">#tag		镜像名字</span></span><br><span class="line">docker run -d -p 9090:8080 --name larrytomcat -v /home/larry/build/tomcat/<span class="built_in">test</span>:/usr/<span class="built_in">local</span>/apache-tomcat-7.0.108/webapps/<span class="built_in">test</span> -v /home/larry/build/tomcat/tomcatlogs/:/usr/<span class="built_in">local</span>/apache-tomcat-7.0.108/logs diytomcat</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>访问测试 localhost:9090</p>
</li>
<li><p>发布项目（由于做了卷挂载，我们直接在本地编写项目就可以）</p>
</li>
</ol>
<h2 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h2><blockquote>
<p>1.<a href="https://hub.docker.com/">dockerhub地址</a> </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">登录账号：</span><br><span class="line">docker login</span><br><span class="line"><span class="comment">#输入用户名和密码</span></span><br><span class="line">推送docker push</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.<a href="https://cr.console.aliyun.com/repository/cn-hangzhou/larry-test/diytomcat/details">阿里云地址</a></p>
</blockquote>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>进入容器镜像服务</span><br><span class="line"><span class="number">2.</span>创建命名空间，创建镜像仓库</span><br><span class="line"><span class="number">3.</span>根据仓库下面的操作指南进行登录和<span class="keyword">push</span>操作</span><br></pre></td></tr></table></figure>

<h1 id="Docker网络"><a href="#Docker网络" class="headerlink" title="Docker网络"></a>Docker网络</h1><h3 id="认识网络"><a href="#认识网络" class="headerlink" title="认识网络"></a>认识网络</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">yb@yangbin:/opt/deepinwine/tools$ ip addr    <span class="comment">#查看ip</span></span><br><span class="line"><span class="comment">#第1个ip ：lo 本机回环地址</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="comment">#第2个ip ：内网地址</span></span><br><span class="line">2: eno1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether a4:bb:6d:e4:b2:26 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp0s31f6</span><br><span class="line">    inet 192.168.10.18/23 brd 192.168.11.255 scope global dynamic noprefixroute eno1</span><br><span class="line">       valid_lft 17214sec preferred_lft 17214sec</span><br><span class="line">    inet6 fe80::1600:597b:ab8f:60e7/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="comment">#第3个ip ：xdroid生成的内网地址</span></span><br><span class="line">3: xdroid0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    link/ether 54:7b:85:ed:17:23 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.252.1/24 scope global xdroid0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="comment">#第4个ip ：docker生成的内网的地址       </span></span><br><span class="line">4: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:56:95:d0:59 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:56ff:fe95:d059/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 创建镜像</span></span><br><span class="line">docker run -d -P --name tomcat01 tomcat</span><br><span class="line"><span class="comment">#2 查看容器的ip </span></span><br><span class="line">docker <span class="built_in">exec</span> -it tomcat01 ip addr</span><br><span class="line"><span class="comment">#3 看能否在外面ping通容器内部ip   能</span></span><br><span class="line"><span class="comment">#4 在容器外重新查找网卡    发现多了一个和容器内网卡绑定的网卡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#容器带来的网卡都是一对一对的，</span></span><br><span class="line"><span class="comment">#evth-pair 就是一堆的虚拟设备接口，它们都是成对出现的，一段连着协议，一段彼此相连</span></span><br><span class="line"><span class="comment">#OpenStack，Docker容器之间的连接，OVS的桥梁，都是使用evth-pair技术</span></span><br></pre></td></tr></table></figure>



<p>Docker使用的是Linux的桥接，宿主机中是一个Docker容器的网桥docker0.</p>
<p><img src="https://i.loli.net/2021/03/02/MxTEkuFawQSsW13.png" alt="docker网络"></p>
<p>个人小结</p>
</div><div class="tags"><a href="/tags/note/"><i class="fa fa-tag"></i>note</a><a href="/tags/docker/"><i class="fa fa-tag"></i>docker</a></div><div class="post-nav"><a class="pre" href="/2021/03/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F_note/">设计模式-note-needtodo</a><a class="next" href="/2021/02/23/webservice%E7%AC%94%E8%AE%B0/"></a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://example.com/2021/03/01/dockerNote/';
    this.page.identifier = '2021/03/01/dockerNote/';
    this.page.title = 'dockerNote';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//fenda.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//fenda.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://fenda.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/juc/" style="font-size: 15px;">juc</a> <a href="/tags/%E5%8F%A5%E5%AD%90/" style="font-size: 25px;">句子</a> <a href="/tags/hexo/" style="font-size: 18.33px;">hexo</a> <a href="/tags/md/" style="font-size: 15px;">md</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/java8/" style="font-size: 15px;">java8</a> <a href="/tags/%E6%96%B0%E7%89%B9%E6%80%A7/" style="font-size: 15px;">新特性</a> <a href="/tags/mybatis/" style="font-size: 15px;">mybatis</a> <a href="/tags/java/" style="font-size: 21.67px;">java</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15px;">算法</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 15px;">数据库</a> <a href="/tags/orcale/" style="font-size: 15px;">orcale</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 15px;">数据结构</a> <a href="/tags/linux/" style="font-size: 18.33px;">linux</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 15px;">日志</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">设计模式</a> <a href="/tags/note/" style="font-size: 18.33px;">note</a> <a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 15px;">集合</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 15px;">博客</a> <a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 15px;">教程</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 15px;">转载</a> <a href="/tags/%E6%88%90%E9%95%BF/" style="font-size: 15px;">成长</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/03/05/JucNote/">JucNote</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/03/RedisNote/">RedisNote</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F_note/">设计模式-note-needtodo</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/01/dockerNote/">dockerNote</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/23/webservice%E7%AC%94%E8%AE%B0/">webservice笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/09/%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97/">查看日志</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/31/git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">git学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/19/java8%E6%96%B0%E7%89%B9%E6%80%A7%E5%AD%A6%E4%B9%A0/">java8新特性学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/13/mybatis%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/">mybatis基本使用及相关注意事项</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/12/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83%E6%80%BB%E7%BB%93/">阿里巴巴代码规范总结</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//fenda.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.baidu.com/" title="百度" target="_blank">百度</a><ul></ul><a href="http://www.bing.com/" title="必应" target="_blank">必应</a><ul></ul><a href="https://www.google.com/ncr" title="Google" target="_blank">Google</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">芬达里没有泡泡.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>